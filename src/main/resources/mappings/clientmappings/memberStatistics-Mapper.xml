<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="client.statistics.dao.MemberStatisticsDAO">

<select id="getMonthlyTotalPrice" resultMap="monthlyTotalPriceList" parameterType="java.util.HashMap">
	<![CDATA[
	select sum(booking_total_price*0.9) booking_total_price, to_char(booking_date, 'fmMM') 
	booking_date from booking  
	where hotels_code = (select hotels_code from hotels where member_id = #{memberId}) 
	and booking_status != 'C' 
	and booking_date between to_date(#{startYear}, 'YYYYMMDD') 
	and to_date(#{endYear}, 'YYYYMMDD') group by to_char(booking_date, 'fmMM') order by booking_date
	]]>
</select>

<resultMap type="java.util.HashMap" id="monthlyTotalPriceList">
	<id column="booking_date" property="booking_date"/>
	<result column="booking_total_price" property="booking_total_price"/>
</resultMap>

</mapper>
